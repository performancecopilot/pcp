#!/bin/sh
#
# Make symlinks from man pages buried off in the source dirs
#

rm -f *.[1-9]*

# file(1) does not work, so need some heuristics
# ... assume existance of $1 already established
#
_istroff()
{
    # shell or other script?
    head -1 "$1" | grep -q '^#!' && return 1
    # generated by podman?
    head -1 "$1" | grep -q 'by Pod::Man' && return 1
    # -man macros?
    grep -q '^\.SH ' <"$1" && return 0
    return 1
}

find ../../src -name *.[1-9]* -type f \
| while read src
do
    if _istroff $src
    then
	dst=`basename "$src"`
	if [ -L ./"$dst" ]
	then
	    echo "Botch: duplicate name $dst"
	    ls -l "$dst"
	    echo "and $src"
	else
	    ln -s "$src" .
	fi
    fi
done

exit 0
