# PCP Build Requirement for Quick Build

The quick build in `scripts/darwin/dev/` requires that PCP has been fully built and installed at least once.

## Why This Requirement Exists

The quick build depends on:
1. **Platform headers** - Generated by configure (e.g., `platform_defs.h`)
2. **Compiled libraries** - libpcp, libpcp_pmda need to exist for linking
3. **Build system files** - Generated by configure

The full `./Makepkgs` command provides all of these.

## One-Time Setup

Run a complete PCP build once:
```bash
cd <repo-root>
./Makepkgs --verbose
```

This:
1. Runs configure to detect your platform
2. Generates all necessary headers
3. Compiles all of PCP
4. Installs libraries and headers
5. Creates the Darwin PMDA

Takes ~5-30 minutes depending on your machine, but only needs to be done once.

## After That

The quick build will work:
```bash
cd scripts/darwin/dev
make clean && make   # 5-10 seconds, not 5-30 minutes!
```

## Verification

To check if PCP is configured:
```bash
cd scripts/darwin/dev
make check-configured
```

If it says `âœ“ PCP is configured`, you're good to go.

If it says configure is needed, the output will tell you exactly what to run.

## How the Makefile Checks This

In `scripts/darwin/dev/Makefile`:
```makefile
# Check if configure has been run
ifeq ($(wildcard $(TOPDIR)/src/include/pcp/platform_defs.h),)
    $(error PCP must be configured first. Run: cd $(TOPDIR) && ./configure)
endif
```

This checks for the presence of `platform_defs.h`. If it doesn't exist, the build fails with a helpful error message.

## CI/CD Handling

In the GitHub Actions workflow (`.github/workflows/macOS.yml`), configure is run automatically before the unit tests:

```yaml
- name: Configure PCP
  run: |
    ./configure --prefix=/usr --libexecdir=/usr/lib --sysconfdir=/etc --localstatedir=/var
```

So CI doesn't have this problem - configure runs as part of the standard build pipeline.

## Impact on Development Workflow

**First time:**
1. Clone repo
2. Run `./configure` (~1-2 minutes)
3. Now you have fast quick builds

**Every time after:**
```bash
# Fast iteration!
cd scripts/darwin/dev && make clean && make   # 5-10 seconds
cd ../test/unit && ./run-unit-tests.sh         # 10-20 seconds
# Total: < 30 seconds per iteration
```

Compare to the old way:
```bash
# From repo root
./Makepkgs --verbose  # 5-30 minutes every time
```

## Summary

- **One-time cost**: ~1-2 minutes for configure
- **Ongoing benefit**: 5-10 second rebuilds instead of 5-30 minutes
- **Totally worth it** for Darwin PMDA development
