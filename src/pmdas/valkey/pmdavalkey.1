'\"macro stdmacro
.\"
.\" Copyright (c) 2026 Red Hat.
.\"
.\" This program is free software; you can redistribute it and/or modify it
.\" under the terms of the GNU General Public License as published by the
.\" Free Software Foundation; either version 2 of the License, or (at your
.\" option) any later version.
.\"
.\" This program is distributed in the hope that it will be useful, but
.\" WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
.\" or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
.\" for more details.
.\"
.TH PMDAVALKEY 1 "PCP" "Performance Co-Pilot"
.SH NAME
\f3pmdavalkey\f1 \- Valkey database PMDA
.SH DESCRIPTION
\f3pmdavalkey\f1 is a Performance Co-Pilot (PCP) Performance Metrics
Domain Agent (PMDA) which extracts live performance data from a running
Valkey database server.
.PP
Valkey is a high-performance data structure server that is a fork of Redis.
The \fBpmdavalkey\fP agent connects to a Valkey server using the INFO
command to retrieve performance metrics covering server operation, memory
usage, client connections, persistence, CPU utilization, and statistics.
.SH CONFIGURATION
\fBpmdavalkey\fP reads an optional configuration file:
.IP
.PD 0
.IP
.I \f(CR$PCP_PMDAS_DIR\fP/valkey/valkey.conf
.PD
.PP
This file contains settings for connecting to the Valkey server:
.TP 15
.B host \fR(\fP\fI127.0.0.1\fP\fR)\fP
Connect to the Valkey server on the given hostname or IP address.
.TP
.B port \fR(\fP\fI6379\fP\fR)\fP
Connect to the Valkey server on the given port.
.PP
The defaults will result in the PMDA connecting to a Valkey server
running on localhost on the standard Valkey port (6379).
.PP
The PMDA caches metric values for a short period (2 seconds) to avoid
overwhelming the Valkey server with frequent INFO command requests.
.SH INSTALLATION
To install, the following must be done as root:
.sp 1
.RS +4
.ft B
.nf
# cd $PCP_PMDAS_DIR/valkey
# ./Install
.fi
.ft P
.RE
.sp 1
To uninstall, the following must be done as root:
.sp 1
.RS +4
.ft B
.nf
# cd $PCP_PMDAS_DIR/valkey
# ./Remove
.fi
.ft P
.RE
.sp 1
\fBpmdavalkey\fP is launched by \fBpmcd\fP(1) and should never be
executed directly.
The \fBInstall\fP and \fBRemove\fP scripts notify \fBpmcd\fP(1) when
the agent is installed or removed.
.SH METRICS
The Valkey PMDA exports the following metric groups:
.TP 15
.B valkey.server
Server information including uptime, process ID, server frequency (hz),
and configuration file location.
.TP
.B valkey.clients
Client connection metrics including number of connected, blocked, tracking,
and pub/sub clients.
.TP
.B valkey.memory
Memory usage metrics including used memory, RSS memory, peak memory usage,
fragmentation ratio, overhead, dataset size, total system memory, and
configured maximum memory.
.TP
.B valkey.stats
Command and connection statistics including total commands processed,
total connections received, rejected connections, keyspace hits and misses,
evicted and expired keys, instantaneous operations per second, and network
I/O byte counts.
.TP
.B valkey.cpu
CPU utilization metrics for both the server process and child processes,
in both user and system time.
.TP
.B valkey.persistence
Persistence-related metrics including RDB save information (changes since
last save, last save time, background save status and duration) and
AOF enabled status.
.SH FILES
.TP 5
.I \f(CR$PCP_PMDAS_DIR\fP/valkey/valkey.conf
configuration file for the \fBpmdavalkey\fR agent
.TP
.I \f(CR$PCP_PMDAS_DIR\fP/valkey/Install
installation script for the \fBpmdavalkey\fR agent
.TP
.I \f(CR$PCP_PMDAS_DIR\fP/valkey/Remove
undo installation script for the \fBpmdavalkey\fR agent
.TP
.I \f(CR$PCP_LOG_DIR\fP/pmcd/valkey.log
default log file for messages from the \fBpmdavalkey\fR agent
.PP
Note that the usual/default value for \fB$PCP_PMDAS_DIR\fP is
.B /var/lib/pcp/pmdas
and the default for \fB$PCP_LOG_DIR\fP is
.B /var/log/pcp
but these settings are platform dependent.
.SH PCP ENVIRONMENT
Environment variables with the prefix \fBPCP_\fR are used to parameterize
the file and directory names used by PCP.
On each installation, the
file \fI/etc/pcp.conf\fR contains the local values for these variables.
The \fB$PCP_CONF\fR variable may be used to specify an alternative
configuration file, as described in \fBpcp.conf\fR(5).
.SH SEE ALSO
.BR PCPIntro (1),
.BR pmcd (1),
.BR valkey-server (1)
and
.BR https://valkey.io .

.\" control lines for scripts/man-spell
.\" +ok+ pmdavalkey valkey {both proper names}
